
<!DOCTYPE HTML>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <title>伯遠君の部屋</title>

  <meta name="author" content="ScorpioHW">
  
  <meta name="description" content="关于八爪鱼的自动处理 Dec 14th, 2013 一直觉得 octopress 虽然很简洁，很实用。但是管理起来很麻烦，尤其是写一篇博客就要进行很多次 rake，还需要对 git 进行管理。如果经常写博客的话，重复性操作很多，和商业博客服务比起来很是不方便。所以我一直希望能够写一个好用些的脚本 &hellip;">
  
  

  <link rel="canonical" href="http://scorpiohw.github.com/blog/2013/12/14/guan-yu-ba-zhua-yu-de-zi-dong-chu-li">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="伯遠君の部屋" type="application/atom+xml">
</head>
  
<body class="default">
  <div id="wrapper">
    <div id="header">
  <h1><a href="/">伯遠君の部屋</a></h1>
  
    <p>行走在旅途。</p>
  
</div>
<ul id="social-links">
  
    <li><a class="feed" href="/atom.xml" title="RSS">RSS</a></li>
  
  
  
    <li> <a class="github" href="https://github.com/scorpiohw" title="GitHub">GitHub</a> </li>
  
  
    <li> <a class="weibo" href="http://weibo.com/takihiko" title="Weibo">Weibo</a> </li>
  
</ul>
<div class="clear"></div>
<ul id="nav">
  
    <li> <a href="/">blog</a> </li>
  

  
    <li><a href="/blog/archives">archives</a></li>
  

  
    <li><a href="/about">about</a></li>
  
</ul>

    <div id="main"> <div class="post-header">
  
    <h1 class="post-title">关于八爪鱼的自动处理</h1>
  
  








  


<time datetime="2013-12-14T21:59:00-08:00" pubdate data-updated="true">Dec 14<span>th</span>, 2013</time>
</div>

<div class="post-content"><p>一直觉得 octopress 虽然很简洁，很实用。但是管理起来很麻烦，尤其是写一篇博客就要进行很多次 rake，还需要对 git 进行管理。如果经常写博客的话，重复性操作很多，和商业博客服务比起来很是不方便。所以我一直希望能够写一个好用些的脚本，让这些工作自动进行。至少可以把用户的工作量减少到最少。</p>

<p>很久之前，当我还在本科的时候，我写过一些很简单的脚本，至少能够把「new _post」,「generate」以及预览效果这几个功能自动化控制，也能够把 git 的操作绑定在一条语句执行。不过当时我遇到一个问题。就是不知道该如何得到新生成的 post 的名称。用过的人都知道，那是一个把日期和汉语拼音结合在一起的东西，实在是难以模拟。当时的我还超级菜，就这么卡在了那里，凑了和好一阵子。后来慢慢地写博客少了，也就忘了这件事。现在刚好放假，而我又觉得自己似乎进步了不少。毕竟已经是研究生了嘛。:p 刚好又准备开始重新写博客。于是乎&#8230; 当然是就要「工欲善其事，必先利其器啦」。身为 cs 嫡系，要是连这点事都解决不了，还混个p啊。XD 于是乎，我开始从零开始解决这个问题。</p>

<p>首先我把目标确定到了 ruby 身上。现在 ruby 超级火啊。开源社区基本上都在用它。我也是对他垂涎许久了，这次有机会搞一搞，当然兴奋异常啦。于是乎，打开电脑，找最厚的教程，开始学习！结果看是看的差不多了&#8230; 但是对之前的问题还是没什么头绪。我搞明白了 ruby，人家是 rakefile 啊。细节上还是和标准语法不一样。比如那个【t, args】我就研究了半天&#8230; = = 新人伤不起啊。不过好在搞明白了。其实就是个参数的标准接口。无论你有多少参数都可以通过这两个参数表示出来。在我看来第一个「t」应该是 Object，而第二个 args 就是所有参数的集合。通过它可以直接调用其他所有的参数。之前看 rakefile 的时候，里面采用了&#8217;:title&#8217;，这个写法刚好和「stringex」这个 gem 的库里面某个调用的方法相同。所以&#8230; 我误会了&#8230; 汗&#8230; 害的我研究了半天如何应用 gem 和 stringex. 结果当然是毫无头绪了啊。不过现在总算是知道他们是什么东西了。gem 相当于是 ruby 的一个 package 的管理程序。也就相当于是 homebrew 这样类似功能的一个安装库的程序。但是怎么用似乎很复杂&#8230; 现在都不知道怎么用。而 stringex 顾名思义就是一个 string 的一个增强版。所以现在问题所在就是该如何使用。因为这也是 rakefile 的主要技术关键。于是乎我研究了半天看看 rakefile 是如何配置实现的。不过看了半天，他根本就没有配置，也没有调用什么的。那么我就想，为什么我就调用不了。为什么他就可以？于是乎我又开始检查他做了什么，而我没有做。这或许就是关键所在了。就这样我发现了 bundler 这个东西。原来是因为有 bundler 才能够实现自动调用 gem 的。bundler 的用处就是自动调用 gem 来帮助用户实现相关的功能，减少操作。从这个角度看起来 ruby 这是好东西啊。所有的东西都能够自动实现。包括数据类型的确定和转换。现在竟然连包都可以自动调用，还真是完全贯彻了 ruby 的中心思想啊。</p>

<p>然后我就好好的写了一下 bash 脚本。又有了新的收获。看着自己写的小程序变得像正规的 Unix 程序一样，还可以加参数了就觉得好兴奋啊。好了言归正传，现在我来讲讲我是如何实现这个问题的，以及我的代码是如何写的。</p>

<p>现在我们先来看看我的 bash 脚本。</p>

<pre><code>OCTOPATH='/path/to/your/octopress'

case $1 in 
-n) cd $OCTOPATH
    git pull
    FILEPATH=$(rake new_post["$2"] | grep -o 'source/_posts/.*')
    # FILEPATH=$(~/Applications/Scripts/trnName.rb ["$2"])
    # 只用bash就可以做到的事情，用什么ruby啊...= = 真是2...orzzz
    pbpaste &gt;&gt; $OCTOPATH/$FILEPATH
    rake generate
    echo "Add New Entry Finished"
    open http://octopress.dev
    ;;
-N) cd $OCTOPATH
    git pull
    FILEPATH=$(rake new_post["$2"] | grep -o 'source/_posts/.*')
    open $OCTOPATH/$FILEPATH
    ;;
-g) cd $OCTOPATH
    rake generate
    open http://octopress.dev
    ;;
-p) cd $OCTOPATH
    rake deploy
    git add .
    git commit 
    git push origin source
    echo "Finished GIT Update"
    open http://scorpiohw.github.io
    ;;
esac
</code></pre>

<p>我写了一个小的脚本来实现几个功能。首先也是最重要的就是创建新的文件。实际上一个标准的用户操作是需要多次修改的。而我本人也的确是经常发布之后才发觉原来还有新的地方需要调整。所以我将 deploy 和 generate 分开。这样可以在本地调试好之后再真正的发布到服务器上。也可以达到最佳的使用效果。当然，不是所有时候都需要在创建的时候加入写好的文字。所以我又加入了新的功能，只创建新的文件。然后就是生成功能。因为存在创建空白文件的功能，所以如果继续和 generate 绑定的话，就毫无价值啦。所以肯定要把这个功能分离。当然另外一点是我很懒啦，一个脚本能够完成越多的内容越好，我需要做的事情越少越好。这就是我的原则啦。最后一项功能就是 deploy 了。很简单吧？</p>

<p>好啦，这就是我的脚本啦。你喜欢的话可以直接拿去使用哦～不客气～快乐在于分享嘛～XD</p>
</div>


<div class="post-single">
  <div class="post-meta">
    


    
      <div class="sharing">
  
  
  
</div>

    
  </div>
  <div class="clear"></div>

  
    <div id="comments">
      <h2>Comments</h1>
      <div id="disqus_thread" aria-live="polite"></div>
    </div>
  
</div>
 </div>
    <div id="footer">
 <!--  <div class="panels">
    <div class="license">
      <h2>License</h2>
      <p>如非特别声明，本 Blog 的文章由 ScorpioHW 创作，采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">知识共享署名-非商业性使用-相同方式共享 3.0 Unported 许可协议</a>进行许可。</p>
    </div>

    <div class="posts">
      <h2>Recent Posts</h2>
      <ul>
        
          <li>
            <a href="/blog/2013/12/14/guan-yu-ba-zhua-yu-de-zi-dong-chu-li/">关于八爪鱼的自动处理</a>
          </li>
        
          <li>
            <a href="/blog/2013/05/09/she-ying-de-yi-yi/">摄影的意义</a>
          </li>
        
          <li>
            <a href="/blog/2013/05/09/mo-huan-zhi-yin/">魔幻之音</a>
          </li>
        
          <li>
            <a href="/blog/2013/04/16/duan-zan-de-ting-liu/">短暂的停留</a>
          </li>
        
          <li>
            <a href="/blog/2013/04/04/qing-lu-shi-%5B%3F%5D-chong-wen-hua/">青旅是一种文化</a>
          </li>
        
      </ul>
    </div>

    <div class="douban">
      <h2>Reading</h2>
      
        <script type="text/javascript" src="http://www.douban.com/service/badge/takihiko/?show=collection&amp;select=favorite&amp;n=8&amp;columns=4&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book" ></script>
        <a href="http://www.douban.com/people/takihiko" class="view-douban">takihiko on douban.com&raquo;</a>
      
    </div>
  </div> -->
  <p class="powered">
    如非特别声明，本 Blog 的文章由 ScorpioHW 创作，采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">知识共享署名-非商业性使用-相同方式共享 3.0 Unported 许可协议</a>进行许可。
  </p>
  <p class="powered">
    Powered by <a href="http://octopress.org">Octopress</a> and <a href="https://github.com/iwinux/compbits">Compbits</a>
  </p>
</div>

  </div> <!-- #wrapper end -->

  

  

<script type="text/javascript">
      var disqus_shortname = 'scorpiohw';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://scorpiohw.github.com/blog/2013/12/14/guan-yu-ba-zhua-yu-de-zi-dong-chu-li/';
        var disqus_url = 'http://scorpiohw.github.com/blog/2013/12/14/guan-yu-ba-zhua-yu-de-zi-dong-chu-li/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


  

  

  

</body>
</html>
